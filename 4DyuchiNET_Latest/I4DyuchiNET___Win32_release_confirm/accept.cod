; Listing generated by Microsoft (R) Optimizing Compiler Version 18.00.30501.0 

	TITLE	E:\GitHub\Mso_Code\4DyuchiNET_Latest\accept.cpp
	.686P
	.XMM
	include listing.inc
	.model	flat

INCLUDELIB LIBCMT
INCLUDELIB OLDNAMES

CONST	SEGMENT
$SG91960 DB	'Error', 00H
	ORG $+2
$SG91961 DB	'Fail to Create Accept Thread', 00H
CONST	ENDS
PUBLIC	?StartAcceptThread@@YAHPAVCNetwork@@@Z		; StartAcceptThread
PUBLIC	?EndAcceptThread@@YAHIPAX@Z			; EndAcceptThread
PUBLIC	?AcceptThread@@YGIPAX@Z				; AcceptThread
EXTRN	__imp__CloseHandle@4:PROC
EXTRN	__imp__WaitForSingleObject@8:PROC
EXTRN	__imp__Sleep@4:PROC
EXTRN	__imp__SetThreadPriority@8:PROC
EXTRN	__imp__GetActiveWindow@0:PROC
EXTRN	__imp__MessageBoxA@16:PROC
EXTRN	__imp__closesocket@4:PROC
EXTRN	__imp__WSAAccept@20:PROC
EXTRN	__beginthreadex:PROC
EXTRN	__endthreadex:PROC
EXTRN	?InsertPreConnect@CPreConnectPool@@QAEHPAUCONNECT_ITEM@@@Z:PROC ; CPreConnectPool::InsertPreConnect
EXTRN	?ProcessPreConnectedItem@@YAXXZ:PROC		; ProcessPreConnectedItem
EXTRN	@__security_check_cookie@4:PROC
EXTRN	_memset:PROC
EXTRN	?g_pPreConnectPool@@3PAVCPreConnectPool@@A:DWORD ; g_pPreConnectPool
EXTRN	___security_cookie:DWORD
; Function compile flags: /Odspy
_TEXT	SEGMENT
_index$ = -84						; size = 4
_con$ = -80						; size = 4
$T1 = -76						; size = 4
_len$ = -72						; size = 4
_accept$ = -68						; size = 4
_dwAcceptInterval$ = -64				; size = 4
_pNetwork$ = -60					; size = 4
_item$ = -56						; size = 36
_addr$ = -20						; size = 16
__$ArrayPad$ = -4					; size = 4
_lpVoid$ = 8						; size = 4
?AcceptThread@@YGIPAX@Z PROC				; AcceptThread
; File e:\github\mso_code\4dyuchinet_latest\accept.cpp
; Line 46
  00000	55		 push	 ebp
  00001	8b ec		 mov	 ebp, esp
  00003	83 ec 54	 sub	 esp, 84			; 00000054H
  00006	a1 00 00 00 00	 mov	 eax, DWORD PTR ___security_cookie
  0000b	33 c5		 xor	 eax, ebp
  0000d	89 45 fc	 mov	 DWORD PTR __$ArrayPad$[ebp], eax
; Line 49
  00010	83 4d bc ff	 or	 DWORD PTR _accept$[ebp], -1
; Line 51
  00014	8b 45 08	 mov	 eax, DWORD PTR _lpVoid$[ebp]
  00017	89 45 c4	 mov	 DWORD PTR _pNetwork$[ebp], eax
; File e:\github\mso_code\4dyuchinet_latest\network.h
; Line 68
  0001a	8b 45 c4	 mov	 eax, DWORD PTR _pNetwork$[ebp]
  0001d	8b 40 64	 mov	 eax, DWORD PTR [eax+100]
  00020	89 45 c0	 mov	 DWORD PTR _dwAcceptInterval$[ebp], eax
; File e:\github\mso_code\4dyuchinet_latest\accept.cpp
; Line 54
  00023	83 65 b0 00	 and	 DWORD PTR _con$[ebp], 0
; Line 55
  00027	83 65 ac 00	 and	 DWORD PTR _index$[ebp], 0
; Line 57
  0002b	c7 45 b8 10 00
	00 00		 mov	 DWORD PTR _len$[ebp], 16 ; 00000010H
; Line 58
  00032	ff 75 b8	 push	 DWORD PTR _len$[ebp]
  00035	6a 00		 push	 0
  00037	8d 45 ec	 lea	 eax, DWORD PTR _addr$[ebp]
  0003a	50		 push	 eax
  0003b	e8 00 00 00 00	 call	 _memset
  00040	83 c4 0c	 add	 esp, 12			; 0000000cH
; Line 61
  00043	81 7d c0 e8 03
	00 00		 cmp	 DWORD PTR _dwAcceptInterval$[ebp], 1000 ; 000003e8H
  0004a	76 07		 jbe	 SHORT $LN4@AcceptThre
; Line 62
  0004c	c7 45 c0 e8 03
	00 00		 mov	 DWORD PTR _dwAcceptInterval$[ebp], 1000 ; 000003e8H
$LN4@AcceptThre:
; Line 63
  00053	33 c0		 xor	 eax, eax
  00055	40		 inc	 eax
  00056	74 5e		 je	 SHORT $seg_destroy$12
; File e:\github\mso_code\4dyuchinet_latest\network.h
; Line 99
  00058	8b 45 c4	 mov	 eax, DWORD PTR _pNetwork$[ebp]
  0005b	8b 40 38	 mov	 eax, DWORD PTR [eax+56]
  0005e	89 45 b4	 mov	 DWORD PTR $T1[ebp], eax
; File e:\github\mso_code\4dyuchinet_latest\accept.cpp
; Line 70
  00061	6a 00		 push	 0
  00063	6a 00		 push	 0
  00065	8d 45 b8	 lea	 eax, DWORD PTR _len$[ebp]
  00068	50		 push	 eax
  00069	8d 45 ec	 lea	 eax, DWORD PTR _addr$[ebp]
  0006c	50		 push	 eax
  0006d	ff 75 b4	 push	 DWORD PTR $T1[ebp]
  00070	ff 15 00 00 00
	00		 call	 DWORD PTR __imp__WSAAccept@20
  00076	89 45 bc	 mov	 DWORD PTR _accept$[ebp], eax
; Line 72
  00079	ff 75 c0	 push	 DWORD PTR _dwAcceptInterval$[ebp]
  0007c	ff 15 00 00 00
	00		 call	 DWORD PTR __imp__Sleep@4
; Line 74
  00082	83 7d bc ff	 cmp	 DWORD PTR _accept$[ebp], -1
  00086	75 04		 jne	 SHORT $LN2@AcceptThre
; Line 76
  00088	eb 2c		 jmp	 SHORT $seg_destroy$12
  0008a	eb 2a		 jmp	 SHORT $seg_destroy$12
$LN2@AcceptThre:
; Line 82
  0008c	8b 45 bc	 mov	 eax, DWORD PTR _accept$[ebp]
  0008f	89 45 c8	 mov	 DWORD PTR _item$[ebp], eax
; Line 83
  00092	8b 45 c4	 mov	 eax, DWORD PTR _pNetwork$[ebp]
  00095	89 45 cc	 mov	 DWORD PTR _item$[ebp+4], eax
; Line 84
  00098	83 65 d0 00	 and	 DWORD PTR _item$[ebp+8], 0
; Line 85
  0009c	83 65 d4 00	 and	 DWORD PTR _item$[ebp+12], 0
; Line 86
  000a0	8d 45 c8	 lea	 eax, DWORD PTR _item$[ebp]
  000a3	50		 push	 eax
  000a4	8b 0d 00 00 00
	00		 mov	 ecx, DWORD PTR ?g_pPreConnectPool@@3PAVCPreConnectPool@@A ; g_pPreConnectPool
  000aa	e8 00 00 00 00	 call	 ?InsertPreConnect@CPreConnectPool@@QAEHPAUCONNECT_ITEM@@@Z ; CPreConnectPool::InsertPreConnect
; Line 87
  000af	e8 00 00 00 00	 call	 ?ProcessPreConnectedItem@@YAXXZ ; ProcessPreConnectedItem
; Line 88
  000b4	eb 9d		 jmp	 SHORT $LN4@AcceptThre
$seg_destroy$12:
; Line 90
  000b6	6a 00		 push	 0
  000b8	e8 00 00 00 00	 call	 __endthreadex
  000bd	59		 pop	 ecx
; Line 92
  000be	33 c0		 xor	 eax, eax
; Line 93
  000c0	8b 4d fc	 mov	 ecx, DWORD PTR __$ArrayPad$[ebp]
  000c3	33 cd		 xor	 ecx, ebp
  000c5	e8 00 00 00 00	 call	 @__security_check_cookie@4
  000ca	8b e5		 mov	 esp, ebp
  000cc	5d		 pop	 ebp
  000cd	c2 04 00	 ret	 4
?AcceptThread@@YGIPAX@Z ENDP				; AcceptThread
_TEXT	ENDS
; Function compile flags: /Odspy
_TEXT	SEGMENT
_socketListen$ = 8					; size = 4
_hAcceptThread$ = 12					; size = 4
?EndAcceptThread@@YAHIPAX@Z PROC			; EndAcceptThread
; File e:\github\mso_code\4dyuchinet_latest\accept.cpp
; Line 34
  00000	55		 push	 ebp
  00001	8b ec		 mov	 ebp, esp
; Line 35
  00003	83 7d 08 ff	 cmp	 DWORD PTR _socketListen$[ebp], -1
  00007	75 04		 jne	 SHORT $LN1@EndAcceptT
; Line 36
  00009	33 c0		 xor	 eax, eax
  0000b	eb 20		 jmp	 SHORT $LN2@EndAcceptT
$LN1@EndAcceptT:
; Line 38
  0000d	ff 75 08	 push	 DWORD PTR _socketListen$[ebp]
  00010	ff 15 00 00 00
	00		 call	 DWORD PTR __imp__closesocket@4
; Line 39
  00016	6a ff		 push	 -1
  00018	ff 75 0c	 push	 DWORD PTR _hAcceptThread$[ebp]
  0001b	ff 15 00 00 00
	00		 call	 DWORD PTR __imp__WaitForSingleObject@8
; Line 40
  00021	ff 75 0c	 push	 DWORD PTR _hAcceptThread$[ebp]
  00024	ff 15 00 00 00
	00		 call	 DWORD PTR __imp__CloseHandle@4
; Line 42
  0002a	33 c0		 xor	 eax, eax
  0002c	40		 inc	 eax
$LN2@EndAcceptT:
; Line 43
  0002d	5d		 pop	 ebp
  0002e	c3		 ret	 0
?EndAcceptThread@@YAHIPAX@Z ENDP			; EndAcceptThread
_TEXT	ENDS
; Function compile flags: /Odspy
_TEXT	SEGMENT
_ThreadID$ = -8						; size = 4
_hAcceptHandle$ = -4					; size = 4
_pNetwork$ = 8						; size = 4
?StartAcceptThread@@YAHPAVCNetwork@@@Z PROC		; StartAcceptThread
; File e:\github\mso_code\4dyuchinet_latest\accept.cpp
; Line 15
  00000	55		 push	 ebp
  00001	8b ec		 mov	 ebp, esp
  00003	51		 push	 ecx
  00004	51		 push	 ecx
; Line 16
  00005	83 65 f8 00	 and	 DWORD PTR _ThreadID$[ebp], 0
; Line 18
  00009	8d 45 f8	 lea	 eax, DWORD PTR _ThreadID$[ebp]
  0000c	50		 push	 eax
  0000d	6a 00		 push	 0
  0000f	ff 75 08	 push	 DWORD PTR _pNetwork$[ebp]
  00012	68 00 00 00 00	 push	 OFFSET ?AcceptThread@@YGIPAX@Z ; AcceptThread
  00017	6a 00		 push	 0
  00019	6a 00		 push	 0
  0001b	e8 00 00 00 00	 call	 __beginthreadex
  00020	83 c4 18	 add	 esp, 24			; 00000018H
  00023	89 45 fc	 mov	 DWORD PTR _hAcceptHandle$[ebp], eax
; Line 20
  00026	83 7d fc ff	 cmp	 DWORD PTR _hAcceptHandle$[ebp], -1
  0002a	75 24		 jne	 SHORT $LN1@StartAccep
; Line 22
  0002c	6a 00		 push	 0
  0002e	68 00 00 00 00	 push	 OFFSET $SG91960
  00033	68 00 00 00 00	 push	 OFFSET $SG91961
  00038	ff 15 00 00 00
	00		 call	 DWORD PTR __imp__GetActiveWindow@0
  0003e	50		 push	 eax
  0003f	ff 15 00 00 00
	00		 call	 DWORD PTR __imp__MessageBoxA@16
; File e:\github\mso_code\4dyuchinet_latest\network.h
; Line 71
  00045	8b 45 08	 mov	 eax, DWORD PTR _pNetwork$[ebp]
  00048	83 60 74 00	 and	 DWORD PTR [eax+116], 0
; File e:\github\mso_code\4dyuchinet_latest\accept.cpp
; Line 24
  0004c	33 c0		 xor	 eax, eax
  0004e	eb 17		 jmp	 SHORT $LN2@StartAccep
$LN1@StartAccep:
; Line 26
  00050	6a 02		 push	 2
  00052	ff 75 fc	 push	 DWORD PTR _hAcceptHandle$[ebp]
  00055	ff 15 00 00 00
	00		 call	 DWORD PTR __imp__SetThreadPriority@8
; File e:\github\mso_code\4dyuchinet_latest\network.h
; Line 71
  0005b	8b 45 08	 mov	 eax, DWORD PTR _pNetwork$[ebp]
  0005e	8b 4d fc	 mov	 ecx, DWORD PTR _hAcceptHandle$[ebp]
  00061	89 48 74	 mov	 DWORD PTR [eax+116], ecx
; File e:\github\mso_code\4dyuchinet_latest\accept.cpp
; Line 29
  00064	33 c0		 xor	 eax, eax
  00066	40		 inc	 eax
$LN2@StartAccep:
; Line 30
  00067	8b e5		 mov	 esp, ebp
  00069	5d		 pop	 ebp
  0006a	c3		 ret	 0
?StartAcceptThread@@YAHPAVCNetwork@@@Z ENDP		; StartAcceptThread
_TEXT	ENDS
END
